<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›²å‘æŠ½ç­¾åº”ç”¨</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; margin-top: 50px; background-color: #f4f4f9; color: #333; }
        .container { background: white; max-width: 400px; margin: 0 auto; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        input { padding: 10px; font-size: 16px; width: 80%; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 6px; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 6px; transition: 0.3s; }
        button:hover { background-color: #0056b3; }
        .hidden { display: none; }
        #my-role { font-size: 40px; font-weight: bold; color: #d9534f; margin: 20px 0; }
        #start-btn { background-color: #28a745; margin-top: 20px; }
        #start-btn:hover { background-color: #218838; }
    </style>
</head>
<body>

<div class="container">
    <div id="login-screen">
        <h2>âš”ï¸ ç»„é˜ŸæŠ½ç­¾</h2>
        <input type="text" id="room-id" placeholder="è¾“å…¥æˆ¿é—´å· (å¦‚ 888)" autocomplete="off">
        <br>
        <button onclick="joinRoom()">è¿›å…¥æˆ¿é—´</button>
    </div>

    <div id="room-screen" class="hidden">
        <h2>æˆ¿é—´å·: <span id="display-room"></span></h2>
        <p>ä½ çš„èº«ä»½: <strong id="my-id"></strong> <span id="host-badge" style="color:red; display:none;">(æˆ¿ä¸»)</span></p>
        <hr>
        <p id="host-info"></p>
        <p id="player-list"></p>
        <button id="start-btn" class="hidden" onclick="startDraw()">å‘ç‰Œï¼</button>
        <p id="waiting-text" class="hidden" style="color: #666;">ç­‰å¾…æˆ¿ä¸»å‘ç‰Œ...</p>
    </div>

    <div id="result-screen" class="hidden">
        <h2>ä½ çš„è§’è‰²æ˜¯</h2>
        <div id="my-role"></div>
        <p style="color: #666;">å˜˜ï¼Œåªæœ‰ä½ èƒ½çœ‹åˆ°ï¼</p>
    </div>
</div>

<script>
    let ws;

    function joinRoom() {
        const roomId = document.getElementById('room-id').value.trim();
        if (!roomId) return alert("è¯·è¾“å…¥æˆ¿é—´å·ï¼");

        // è‡ªåŠ¨è¯†åˆ«å½“å‰çš„åŸŸåå¹¶å»ºç«‹ WebSocket è¿æ¥
        const protocol = window.location.protocol === "https:" ? "wss:" : "ws:";
        const wsUrl = `${protocol}//${window.location.host}/ws/${roomId}`;
        
        ws = new WebSocket(wsUrl);

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);

            if (data.type === "welcome") {
                // è¿›å…¥æˆ¿é—´æˆåŠŸï¼Œåˆ‡æ¢ UI
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('room-screen').classList.remove('hidden');
                document.getElementById('display-room').innerText = roomId;
                document.getElementById('my-id').innerText = data.player_id;

                if (data.is_host) {
                    document.getElementById('host-badge').style.display = "inline";
                    document.getElementById('start-btn').classList.remove('hidden');
                } else {
                    document.getElementById('waiting-text').classList.remove('hidden');
                }
            } 
            else if (data.type === "update") {
                // æ›´æ–°æˆ¿é—´äººæ•°çŠ¶æ€
                document.getElementById('host-info').innerText = "ğŸ‘‘ æˆ¿ä¸»: " + data.host;
                document.getElementById('player-list').innerText = `ğŸ‘¥ å½“å‰ç©å®¶ (${data.players.length}/5): ` + data.players.join(", ");
            } 
            else if (data.type === "result") {
                // æ”¶åˆ°è§’è‰²ï¼Œåˆ‡æ¢åˆ°ç»“æœé¡µé¢
                document.getElementById('room-screen').classList.add('hidden');
                document.getElementById('result-screen').classList.remove('hidden');
                document.getElementById('my-role').innerText = data.role;
            } 
            else if (data.type === "error") {
                alert(data.msg);
                if (data.msg === "æˆ¿é—´å·²æ»¡ï¼Œæœ€å¤š5äºº") {
                    ws.close();
                }
            }
        };

        ws.onclose = function() {
            console.log("è¿æ¥å·²æ–­å¼€");
        };
    }

    function startDraw() {
        // å‘Šè¯‰åç«¯ï¼Œæˆ¿ä¸»æŒ‰ä¸‹äº†å¼€å§‹
        ws.send(JSON.stringify({action: "start"}));
    }
</script>

</body>
</html>